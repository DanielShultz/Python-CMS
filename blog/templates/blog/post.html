{% extends "blog/components/base.html" %}
{% load crispy_forms_tags %}
{% block content %}

<article class="media content-section">
    <!-- Информация о посте -->
    <div class="media-body">
        <div class="article-metadata">
            <!-- Автор и дата -->
            <a class="mr-2" href="{{ post.author.profile.get_absolute_url }}">
                {{ post.author.first_name }}
                {{ post.author.last_name }}
            </a>
            <small class="text-muted">{{ post.date_posted|localize }}</small>
        </div>

        <!-- Заголовок -->
        <h2 class="article-title">{{ post.title }}</h2>

        <!-- Рейтинг -->
        {% if post.rating %}
        <div class="article-rating d-flex justify-content-center m-2">
            {% for i in 10|get_range %}
            <i class="fas fa-star {% if i < post.rating %}text-warning{% endif %}"></i>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Изображение -->
        {% if post.image %}
        <img class="article-image" src="{{ post.image.url }}" alt="{{ post.title }}" />
        {% endif %}

        <!-- Цена -->
        {% if post.price %}
        <p class="article-price">{{ post.price }} <i class="fas fa-ruble-sign"></i></p>
        {% endif %}

        <!-- Содержимое -->
        <p class="article-content">{{ post.content }}</p>

        <!-- Лайки -->
        <div class="article-likes mt-2 text-right">
            <form method="POST" action="{% url 'like-post' post.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-site">
                    <i class="fas fa-thumbs-up"></i> {{ post.likes_count }}
                </button>
            </form>
        </div>

        <!-- Навигация -->
        <nav class="d-flex justify-content-between mt-4">
            {% if post.prev_post or post.next_post %}
            {% if post.prev_post %}
            <a class="btn btn-outline-site" href="{{ post.prev_post.get_absolute_url }}">Назад</a>
            {% else %}
            <span></span>
            {% endif %}
            {% if post.next_post %}
            <a class="btn btn-outline-site" href="{{ post.next_post.get_absolute_url }}">Вперёд</a>
            {% else %}
            <span></span>
            {% endif %}
            {% endif %}
        </nav>
    </div>
</article>

<!-- Комментарии -->
{% if comments %}
{% for comment in comments %}
<div class="media content-section" id="comment-{{ comment.pk }}">
    <img class="d-flex mr-3 rounded-circle" src="{{ comment.author.profile.image.url }}" alt="" width="50" height="50">
    <div class="media-body">
        <div class="article-metadata">
            <a class="mr-2" href="{{ comment.author.profile.get_absolute_url }}">
                {{ comment.author.first_name }}
                {{ comment.author.last_name }}
            </a>
            <small class="text-muted">{{ comment.date_posted|localize }}</small>
        </div>
        <div class="d-flex justify-content-between align-items-center">
            <p class="article-content mb-0">{{ comment.content }}</p>
            {% if user == comment.author %}
            <a class="btn btn-outline-danger btn-sm" href="{% url 'delete-comment' post.pk comment.pk %}">
                Удалить
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<!-- Форма комментирования -->
{% if user.is_authenticated %}
<div class="content-section">
    <form method="POST" action="{% url 'add-comment' post.pk %}">
        {% csrf_token %}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">Добавить комментарий</legend>
            {{ comment_form|crispy }}
        </fieldset>
        <div class="form-group mt-2">
            <button class="btn btn-outline-site" type="submit">Отправить</button>
        </div>
    </form>
</div>
{% endif %}

{% endblock content %}